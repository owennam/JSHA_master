# JSHA 병원 지도 자동 업데이트 설정 가이드

## 📋 개요

Google Sheets의 병원 데이터를 자동으로 웹사이트 지도에 반영하는 시스템입니다.

## 🚀 설정 단계

### 1단계: Apps Script 설정

1. **Google Sheets 열기**
   - 병원 데이터 스프레드시트 열기: https://docs.google.com/spreadsheets/d/1PzoB9woQ_5TuiszQ8rHLV0GFFlgbVQqcfD_UqES63q0

2. **Apps Script 편집기 열기**
   - 메뉴: `확장 프로그램` → `Apps Script`

3. **스크립트 복사**
   - 프로젝트 루트의 `apps-script-hospital-map.js` 파일 내용 전체 복사
   - Apps Script 편집기에 붙여넣기 (기존 코드 덮어쓰기)

4. **저장**
   - Ctrl+S 또는 저장 버튼 클릭

### 2단계: 웹 앱으로 배포

1. **배포 시작**
   - Apps Script 편집기 우측 상단 `배포` → `새 배포` 클릭

2. **배포 설정**
   - **유형 선택**: ⚙️ 아이콘 클릭 → `웹 앱` 선택
   - **설명**: "병원 지도 데이터 API" (선택사항)
   - **실행 계정**: `나`
   - **액세스 권한**: `누구나` ⚠️ 중요!

3. **배포 완료**
   - `배포` 버튼 클릭
   - 권한 승인 (Google 계정 로그인 및 권한 허용)
   - **웹 앱 URL 복사** (예: `https://script.google.com/macros/s/AKfycby.../exec`)

### 3단계: 환경 변수 설정

1. **프로젝트 루트에 `.env` 파일 생성** (없으면)

2. **Apps Script URL 추가**
   ```env
   VITE_APPS_SCRIPT_URL=복사한_웹앱_URL
   ```

3. **저장**

### 4단계: 테스트

1. **개발 서버 실행**
   ```bash
   npm run dev
   ```

2. **병원 페이지 접속**
   - http://localhost:5173/hospitals

3. **지도 확인**
   - 병원 마커가 표시되는지 확인
   - 빨간색(ON) / 파란색(기타) 구분 확인
   - 마커 클릭 시 팝업 확인

## 🎨 기능

### 마커 색상
- 🔴 **빨간색**: 비고 컬럼이 "ON"인 병원 (운영 중)
- 🔵 **파란색**: 비고 컬럼이 빈칸이거나 "ON"이 아닌 병원
- ⚫ **숨김**: 비고 컬럼이 "OFF"인 병원 (지도에 표시 안 됨)

### z-index 우선순위
- 같은 위치에 여러 병원이 있을 경우 빨간색 마커가 위에 표시됩니다

### 자동 업데이트
- 시트 데이터 변경 후 최대 1시간 이내 자동 반영 (캐시 만료 시)
- 즉시 반영 필요 시: Apps Script에서 `🔄 캐시 새로고침` 메뉴 실행

## 🔧 문제 해결

### 지도가 표시되지 않을 때

1. **브라우저 콘솔 확인** (F12)
   - CORS 오류: Apps Script 배포 설정 확인
   - 404 오류: `.env` 파일의 URL 확인

2. **Apps Script 테스트**
   - Apps Script 편집기에서 `🧪 JSON 데이터 테스트` 메뉴 실행
   - 오류 메시지 확인

3. **배포 URL 확인**
   - 브라우저에서 직접 Apps Script URL 접속
   - JSON 데이터가 표시되는지 확인

### 데이터가 업데이트되지 않을 때

1. **캐시 새로고침**
   - Apps Script: `📍 병원 지도 관리` → `🔄 캐시 새로고침`

2. **시트 구조 확인**
   - "시트1" 시트 존재 확인
   - "이름", "주소", "비고" 컬럼 존재 확인

## 📝 시트 데이터 형식

| 이름 | 주소 | 비고 |
|------|------|------|
| 서울병원 | 서울시 강남구... | ON |
| 부산병원 | 부산시 해운대구... | |
| 대구병원 | 대구시 수성구... | OFF |

- **이름**: 병원명 (마커 팝업에 표시)
- **주소**: 전체 주소 (지오코딩에 사용)
- **비고**: ON / OFF / 빈칸

## 🎯 다음 단계

- ✅ Apps Script 배포 완료
- ✅ 환경 변수 설정 완료
- ✅ 지도 표시 확인
- 🔄 실제 병원 데이터 입력
- 🔄 프로덕션 배포
